<!DOCTYPE html>
<html>
<head>
    <title>八闽租车系统</title>
    <meta charset="utf-8"/>
    <link rel="shortcut icon" href="assets/ico/favicon.png" type="image/x-icon" />
    <link rel="stylesheet" href="JS/jquery-ui.css">
    <link rel="stylesheet" href="JS/jquery.dataTables.css" type="text/css">
    <style>
        html,body{
            margin: 0;
            height: 100%;
        }
        .top1{
            background-color: #4a4a4a;
            color: #ffffff;
            margin: 0;
            width: 20%;
            height: 50px;
            line-height: 50px;
            text-align: center;
            border-right:1px solid #ffffff ;
            font-size: 30px;
            float: left;
        }
        .top2{
            width: 100%;
            background-color: #4a4a4a;
            height: 50px;
        }
        .lan1{
            width: 20%;
            height: 100%;
            background-color: #1f5377;
            color: #ffffff;
        }
        .top3{
            color: #ffffff;
            height: 65px;
            background-color: #1f5377;
            width: 79.95%;
            float: right;
            border-left:1px solid #ffffff;

        }
        .mainpage{
            width: 79.9%;
            float: right;
            clear: left;
        }
        .icon{

            text-align: center;
            color: #ffffff;
            padding-bottom: 10px;
            padding-top: 10px ;
        }
        #icon{
            height: 85px;
            width: 85px;
        }
        .op p{
            margin: 10px 0;
            padding-top: 0;
            height: 48px;
            line-height: 48px;
        }
        .op p a{
            clear: left;
            text-decoration: none;
            color: #ffffff;
            font-size: 25px;
            margin: 10px 10px;
        }
        .op p a img{
            float: left;
        }
        #biao{
            width: 100%;
        }
        .check{
            float: left;
            height: 48px;
            margin-right: 25px;
            visibility: hidden;
        }
        .show{
            visibility: visible;
        }
        .c{
            background-color: #24638e;
        }
        .top3 div{
            height:65px;
            margin: 0 30px;
            line-height: 65px;
            font-size: 25px;
        }
        .top3 p{
            margin: 0;
        }
        .top3 p img{
            margin: 10px;
            float: left;
        }
        #loadorders,#others{
            width: 98%;
            margin: 0 auto;
        }
        #others table{
            margin: 0;
        }
        #others input{
            margin-right: 59px;
        }
        #others td{
            height: 25px;
        }

        .bo,textarea{
            border-radius:5px;
        }
        textarea{
            width: 92%;
            clear:left;
            height: 70px;
        }
        #btns{
            text-align: center;
        }
        #btns button{
            margin-right:50px ;
            width:100px;
            height: 30px;
            border-radius:3px;border:1px solid #000;
        }
        #orders{
            font-size: 10px;
        }
        #o input{
            width: 100px;
            margin-left: 5px;
        }
        #o{
            margin-left: 4px;
        }
        #o p{
            margin: 0;
            padding-bottom: 10px;
        }
        div input{
            height:25px;
            border-radius:3px;border:1px solid #000;
            margin: 10px;
        }
        .area{
            border-radius:3px;border:1px solid #000;
        }
        .light{
            color: red;
        }
        .oo{
            background-color: #cccccc;
        }
        .tableClass{
            overflow:hidden;
            word-break: keep-all;
            white-space:nowrap;
        }
        input[type=text]{
            padding-left:10px;
        }
    </style>
</head>
<body>
<div class="top1">租车行</div>
<div class="top2"></div>
<div class="top3"><div><p><img src="images/huanche.png">还车</p></div></div>
<div class="mainpage">
    <form>
        <input type="hidden" name="zuchuDate"/>
        <input type="hidden" name="timePrice"/>
        <input type="hidden" name="limitMileage"/>
        <input type="hidden" name="beforeMileage"/>
        <input type="hidden" name="outMileagePrice"/>
        <input type="hidden" name="outTimePrice"/>
        <input type="hidden" name="advancePayment"/>
        <input type="hidden" name="planReturnDate" value="2016-03-23 00:00:00"/>
        <input type="hidden" name="outTimePrice"/>
        <input type="hidden" name="outTimePrice"/>
        <input type="hidden" name="planId"/>
        <input type="hidden" name="orderId"/>
        <input type="hidden" name="accountId"/>
    <div id="loadorders">
        <p>租出车辆</p>
        <table id="orders" class="tableClass">
            <thead>
                <th>车辆</th>
                <th>方式</th>
                <th>租出日期</th>
                <th>价格</th>
                <th>限里程</th>
                <th>租出时里程</th>
                <th>超程单价</th>
                <th>超时小时价（元/小时）</th>
                <th>预付款</th>
                <th>计划还车时间</th>
                <th>客户</th>
                <th>联系电话</th>
            </thead>
        </table>
    </div>
    <div id="others">
        <table>
            <tr>
                <td><span>车辆</span></td>
                <td><input type="text" class="bo" name="licensePlate"/></td>
                <td><span>还车时间</span></td>
                <td><input type="text"  class="bo" name="huancheDate" id="datepicker" readonly/></td>
                <td><span>还车时里程数</span></td>
                <td><input type="text"  class="bo" name="afterMileage"/></td>
            </tr>
            <tr>
                <td><span>计价时间</span></td>
                <td><input type="text"  class="bo" name="jijiatime"/></td>
                <td><span>计时应收租金</span></td>
                <td><input type="text"  class="bo" name="timePrice"/></td>
                <td><span>超程租金</span></td>
                <td><input type="text"  class="bo" name="outMileagePrice"/></td>
            </tr>
            <tr>
                <td colspan="5"><span>合计应收租金</span><input type="text" style="margin-left: 5px"  class="bo"/></td>
            </tr>
        </table>
        <div id="o">
            <p style="float: left" >预付款<input type="text" class="bo" name="advancePayment"/></p>
            <p style="float: left">应退押金<input type="text" readonly style="border: 0px"/></p>
            <p style="float: left">实收押金<input type="text"  class="bo" name="shouyajin"/></p>
            <p style="float: left">结算实收金额<input type="text"  class="bo" name="price"/></p>
            <p style="clear: left"><span style="float:left;margin-right: 10px;">备注</span><textarea class="area" name="note"></textarea></p>
        </div>
    </div>
    <div id="btns">
         <button onclick="returnCar();">还车</button>
         <button onclick="returnAndBilling();">还车结算</button>
         <button onclick="exitPage();">退出</button>
    </div>
    </form>
</div>
<div class="lan1">
    <div class="icon">
        <div>
            <div><img id="icon" src="icon/touxiang.png"/></div>
            <div><img src="images/lvdian.png"/><label>Admin</label></div>
            <div><img id="biao" src="images/baisetiao.png"/> </div>
        </div>
    </div>
    <div class="op">
        <p><img class="check" src="images/check.png"><a href="/bmpw/toZC_Cheliangxinxi"><img src="images/chelianxinxi.png">车辆信息</a></p>
        <p><img class="check" src="images/check.png"><a href="/bmpw/toZC_AddCar"><img src="images/chelianxinzeng.png"/>车辆新增</a></p>
        <p><img class="check" src="images/check.png"><a href="/bmpw/toZC_Plans"><img src="images/zulenfangan.png">租赁方案</a></p>
        <p><img class="check" src="images/check.png"><a href="/bmpw/toZC_Zuche"><img src="images/zuche.png">租车</a></p>
        <p class="c"><img class="check show" src="images/check.png"><a href="#"><img src="images/huanche.png"/>还车</a></p>
        <p><img class="check" src="images/check.png"><a href="#"><img src="images/jiesuan.png"/>结算</a></p>
        <p><img class="check" src="images/check.png"><a href="/bmpw/toZC_Account"><img src="images/kehu.png"/>客户</a></p>
        <p><img class="check" src="images/check.png"><a href="/bmpw/toZC_Appointment"><img src="images/yudingdengji.png"/>预定登记</a></p>
    </div>
</div>
<script src="JS/jquery-1.12.0.js"></script>
<script src="JS/jquery-ui.js"></script>
<script src="JS/jquery.dataTables.js"></script>
<script src="JS/jquery/jquery-ui-timepicker-addon.js"></script>
<script src="JS/jquery/jquery-ui-timepicker-zh-CN.js"></script>
<script>
    $(function(){
        $("#orders").dataTable({
            "serverSide":true,
            "processing": true,
            "ajax":"/bmpw/zc/order/loadcancompleteorder",
            "scrollY": "200px",
            "scrollCollapse": "true",
            "bSort":false,
            "bLengthChange":false,
            "bInfo":false,
            "oLanguage": {
                "sLengthMenu": "每页显示 _MENU_ 条记录",
                "sZeroRecords": "抱歉， 没有找到",
                "sInfo": "从 _START_ 到 _END_ /共 _TOTAL_ 条数据",
                "sInfoEmpty": "没有数据",
                "sInfoFiltered": "(从 _MAX_ 条数据中检索)",
                "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "前一页",
                    "sNext": "后一页",
                    "sLast": "尾页"
                },
                "sSearch":"根据车牌号查询"
            },
            "columns":[
                { "data": "car.licensePlate" },
                { "data": "order.status" },
                { "data": "order.zuchuDate"},
                { "data": "order.timePrice"},
                { "data": "order.limitMileage"},
                { "data": "order.beforeMileage"},
                { "data": "order.outMileagePrice"},
                { "data": "order.outTimePrice"},
                { "data": "order.advancePayment"},
                { "data": "order.planReturnDate"},
                { "data": "account.name"},
                { "data": "account.phone"}
            ],
            "createdRow": function ( row, data, dataindex ) {
                if(data.order.status==0){
                    $('td', row).eq(1).text("企业租车");
                }
                if(data.order.status==1){
                    $('td', row).eq(1).text("个人租车");
                }
            }
        });
        /*订单数据获取完成*/

        $("#loadorders").on("click","td",function(){
            $("tr.light").removeClass("light");
            $($(this).parent("tr")).addClass("light");
            $("td.oo").removeClass("oo");
            $(this).addClass("oo");
            $(this).siblings().addClass("oo");
            var data = $("#orders").DataTable().row($(this).parents("tr")).data();
            $(":input[name=licensePlate]").val(data.licensePlate);
            $(":input[name=orderId]").val(data.id);
            $(":input[name=zuchuDate]").val(data.zuchuDate);
            $(":input[name=timePrice]").val(data.timePrice);
            $(":input[name=limitMileage]").val(data.limitMileage);
            $(":input[name=beforeMileage]").val(data.beforeMileage);
            $(":input[name=outMileagePrice]").val(data.outMileagePrice);
            $(":input[name=outTimePrice]").val(data.outTimePrice);
            $(":input[name=advancePayment]").val(data.advancePayment);
            $(":input[name=planReturnDate]").val(data.planReturnDate);
            $(":input[name=outTimePrice]").val(data.outTimePrice);
            $(":input[name=outTimePrice]").val(data.outTimePrice);
            $(":input[name=accountId]").val(data.accountId);
        });
        $( "#datepicker" ).datetimepicker({
            regional:"zh-CN",
            dateFormat:"yy-mm-dd",
            timeFormat: "hh:mm:ss"
        });
        $("#datepicker").blur(function (){

        });
    });
    function returnCar(){
        var id = $(":input[name=orderId]").val();
        window.location.href = "/bmpw/zc/order/returnCar?orderId="+id;
    }
    function returnAndBilling(){
        var huancheDate = new Date($("#datepicker").val().replace(/-/g,"/") );
        var zucheDate = new Date($(":input[name=zuchuDate]").val().replace(/-/g,"/"));
        var planReturnDate = new Date($(":input[name=planReturnDate]").val().replace(/-/g,"/"));

        var cha = huancheDate.getTime() - planReturnDate.getTime();//时间差的毫秒数

        //计算出相差天数
        var days=Math.floor(cha/(24*3600*1000));
        //计算出小时数
        var leave1=cha3%(24*3600*1000);    //计算天数后剩余的毫秒数
        var hours=Math.floor(leave1/(3600*1000));
        //计算相差分钟数
        var leave2=leave1%(3600*1000);        //计算小时数后剩余的毫秒数
        var minutes=Math.floor(leave2/(60*1000));
        //计算相差秒数
        var leave3=leave2%(60*1000);
        //计算分钟数后剩余的毫秒数
        var seconds=Math.round(leave3/1000);
        alert(" 相差 "+days+"天 "+hours+"小时 "+minutes+" 分钟"+seconds+" 秒");
        if(huancheDate>planReturnDate){
            alert(huancheDate+ "-" + planReturnDate + "=" + (huancheDate-planReturnDate));
        }


    }
    function billing(){

        //var
    }
</script>
</body>
</html>