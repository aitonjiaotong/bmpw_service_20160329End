<!DOCTYPE html>
<html>
<head>
    <title>八闽租车系统</title>
    <meta charset="utf-8"/>
    <link rel="shortcut icon" href="assets/ico/favicon.png" type="image/x-icon" />
    <link rel="stylesheet" href="JS/jquery-ui.css">
    <link rel="stylesheet" href="JS/jquery.dataTables.css" type="text/css">
    <style>
        html,body{
            margin: 0;
            height: 100%;
        }
        .top1{
            background-color: #4a4a4a;
            color: #ffffff;
            margin: 0;
            width: 20%;
            height: 50px;
            line-height: 50px;
            text-align: center;
            border-right:1px solid #ffffff ;
            font-size: 30px;
            float: left;
        }
        .top2{
            width: 100%;
            background-color: #4a4a4a;
            height: 50px;
        }
        .lan1{
            width: 20%;
            height: 100%;
            background-color: #1f5377;
            color: #ffffff;
        }
        .top3{
            color: #ffffff;
            height: 65px;
            background-color: #1f5377;
            width: 79.95%;
            float: right;
            border-left:1px solid #ffffff;

        }
        .mainpage{
            width: 79.9%;
            float: right;
            clear: left;
        }
        .icon{

            text-align: center;
            color: #ffffff;
            padding-bottom: 10px;
            padding-top: 10px ;
        }
        #icon{
            height: 85px;
            width: 85px;
        }
        .op p{
            margin: 10px 0;
            padding-top: 0;
            height: 48px;
            line-height: 48px;
        }
        .op p a{
            clear: left;
            text-decoration: none;
            color: #ffffff;
            font-size: 25px;
            margin: 10px 10px;
        }
        .op p a img{
            float: left;
        }
        #biao{
            width: 100%;
        }
        .check{
            float: left;
            height: 48px;
            margin-right: 25px;
            visibility: hidden;
        }
        .show{
            visibility: visible;
        }
        .c{
            background-color: #24638e;
        }
        .top3 div{
            height:65px;
            margin: 0 30px;
            line-height: 65px;
            font-size: 25px;
        }
        .top3 p{
            margin: 0;
        }
        .top3 p img{
            margin: 10px;
            float: left;
        }
        #loadorders,#others{
            width: 98%;
            margin: 0 auto;
        }
        #others table{
            margin: 0;
        }
        #others input{
            margin-right: 59px;
        }
        #others td{
            height: 25px;
        }

        .bo,textarea{
            border-radius:5px;
        }
        textarea{
            width: 92%;
            clear:left;
            height: 70px;
        }
        #btns{
            text-align: center;
        }
        #btns button{
            margin-right:50px ;
            width:100px;
            height: 30px;
            border-radius:3px;border:1px solid #000;
        }
        #orders{
            font-size: 10px;
        }
        #o input{
            width: 100px;
            margin-left: 5px;
        }
        #o{
            margin-left: 4px;
        }
        #o p{
            margin: 0;
            padding-bottom: 10px;
        }
        div input{
            height:25px;
            border-radius:3px;border:1px solid #000;
            margin: 10px;
        }
        .area{
            border-radius:3px;border:1px solid #000;
        }
        .light{
            color: red;
        }
        .oo{
            background-color: #cccccc;
        }
        .tableClass{
            margin-top: 0;
            overflow:hidden;
            word-break: keep-all;
            white-space:nowrap;
        }
        input[type=text]{
            padding-left:10px;
        }
        input:read-only{
            background:#ddd;
        }
    </style>
</head>
<body>
<div class="top1">租车行</div>
<div class="top2"></div>
<div class="top3"><div><p><img src="images/huanche.png">还车</p></div></div>
<div class="mainpage">
    <form>
        <!-- 租出时间 -->
       <!-- <input type="hidden" name="zuchuDate"/>  -->
        <!-- 计价时间 -->
      <!--  <input type="hidden" name="jijiatime"/> -->
        <!-- 计划还车时间-->
     <!--   <input type="hidden" name="planReturnDate"/> -->
        <!-- 计时单价 -->
      <!--  <input type="hidden" name="unitPrice"/> -->
        <!-- 开始里程数 -->
     <!--   <input type="hidden" name="beforeMileage"/> -->
        <!-- 限制里程数 -->
      <!--  <input type="hidden" name="limitMileage"/> -->
        <!-- 超时单价 -->
     <!--   <input type="hidden" name="unitOutTime"/> -->
        <!-- 超程单价 -->
     <!--   <input type="hidden" name="unitOutMileage"/>  -->

        <input type="hidden" name="orderId"/>

    <div id="loadorders">
        <br>
        <p style="font-weight:bold;">请选择车辆</p>
        <table id="orders" class="tableClass">
            <thead>
                <th>车辆</th>
                <th>方式</th>
                <th>租出日期</th>
                <th>价格</th>
                <th>限里程</th>
                <th>租出时里程</th>
                <th>超程单价</th>
                <th>超时小时价（元/小时）</th>
                <th>预付款</th>
                <th>计划还车时间</th>
                <th>客户</th>
                <th>联系电话</th>
            </thead>
        </table>
    </div>
        <div>
            <table style="margin-left:20px; ">
                <tr><td>请输入还车时间</td><td><input type="text" style="margin-left: 50px;" name="huancheDate" id="datepicker" readonly/>
                </td><td><span style="float:right;margin-right: 20px;">车牌号</span></td>
                    <td><input type="text" class="bo" name="licensePlate" readonly/></td></tr>
                <tr><td><span>还车时里程数</span></td><td><input style="margin-left: 50px;" type="text"  class="bo" name="afterMileage"/></td>
                    <td><input type="button" value="还车" style="width: 100px;" onclick="returnCar()"/></td>
                </tr>
            </table>
        </div>
    <div id="others">
        <table>
            <tr>
                <td><span>正常约定租金</span></td>
                <td><input type="text"  class="bo" name="timePrice" readonly/></td>
                <!-- 正常计时租金 -->
                <td></td>
                <td></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <!-- 超程租金 -->
                <td><span>超程租金</span></td>
                <td><input type="text"  class="bo" name="outMileagePrice" readonly/></td>
                <!-- 超时租金 -->
                <td><span>超时租金</span></td>
                <td><input type="text"  class="bo" name="outTimePrice" readonly/></td>
                <td></td>
                <td></td>
            </tr>
            <tr>
                <td><span>其他扣款</span></td>
                <td><input type="text" class="bo" id="penalty"/></td>
                <td><span>扣款备注</span></td>
                <td><input type="text" class="bo"/></td>
            </tr>
            <tr>
                <td><span>合计应收租金</span></td><td colspan="4"><input type="text" style="margin-left: 10px"  class="bo" id="price" readonly/></td>
            </tr>
        </table>
        <div id="o">
            <!-- 预收租金 -->
            <p style="float: left" >预付款<input type="text" class="bo" name="advancePayment" readonly/></p>
            <p style="float: left">应退押金<input type="text" readonly /></p>
            <p style="float: left">实收押金<input type="text"  class="bo" name="shouyajin" readonly/></p>
            <!-- 实收的总金额 -->
            <p style="float: left">结算实收金额<input type="text"  class="bo" name="price"/></p>
            <p style="clear: left"><span style="float:left;margin-right: 10px;">备注</span><textarea class="area" name="note"></textarea></p>
        </div>
    </div>
    <div id="btns">
         <button onclick="returnAndBilling();">还车结算</button>
         <button onclick="exitPage();">退出</button>
    </div>
    </form>
</div>
<div class="lan1">
    <div class="icon">
        <div>
            <div><img id="icon" src="icon/touxiang.png"/></div>
            <div><img src="images/lvdian.png"/><label>Admin</label></div>
            <div><img id="biao" src="images/baisetiao.png"/> </div>
        </div>
    </div>
    <div class="op">
        <p><img class="check" src="images/check.png"><a href="/bmpw/toZC_Cheliangxinxi"><img src="images/chelianxinxi.png">车辆信息</a></p>
        <p><img class="check" src="images/check.png"><a href="/bmpw/toZC_AddCar"><img src="images/chelianxinzeng.png"/>车辆新增</a></p>
        <p><img class="check" src="images/check.png"><a href="/bmpw/toZC_Plans"><img src="images/zulenfangan.png">租赁方案</a></p>
        <p><img class="check" src="images/check.png"><a href="/bmpw/toZC_Zuche"><img src="images/zuche.png">租车</a></p>
        <p class="c"><img class="check show" src="images/check.png"><a href="#"><img src="images/huanche.png"/>还车</a></p>
        <p><img class="check" src="images/check.png"><a href="#"><img src="images/jiesuan.png"/>结算</a></p>
        <p><img class="check" src="images/check.png"><a href="/bmpw/toZC_Account"><img src="images/kehu.png"/>客户</a></p>
        <p><img class="check" src="images/check.png"><a href="/bmpw/toZC_Appointment"><img src="images/yudingdengji.png"/>预定登记</a></p>
    </div>
</div>
<script src="JS/jquery-1.12.0.js"></script>
<script src="JS/jquery-ui.js"></script>
<script src="JS/jquery.dataTables.js"></script>
<script src="JS/jquery/jquery-ui-timepicker-addon.js"></script>
<script src="JS/jquery/jquery-ui-timepicker-zh-CN.js"></script>
<script>
    var flag = 0;
    $(function(){
        $("#orders").dataTable({
            "serverSide":true,
            "processing": true,
            "ajax":"/bmpw/zc/order/loadcancompleteorder",
            "scrollY": "200px",
            "scrollCollapse": "true",
            "bSort":false,
            "bLengthChange":false,
            "bInfo":false,
            "oLanguage": {
                "sLengthMenu": "每页显示 _MENU_ 条记录",
                "sZeroRecords": "抱歉， 没有找到",
                "sInfo": "从 _START_ 到 _END_ /共 _TOTAL_ 条数据",
                "sInfoEmpty": "没有数据",
                "sInfoFiltered": "(从 _MAX_ 条数据中检索)",
                "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "前一页",
                    "sNext": "后一页",
                    "sLast": "尾页"
                },
                "sSearch":"根据车牌号查询"
            },
            "columns":[
                { "data": "car.licensePlate" },
                { "data": "order.status" },
                { "data": "order.zuchuDate"},
                { "data": "plan.price"},
                { "data": "order.limitMileage"},
                { "data": "order.beforeMileage"},
                { "data": "plan.outMileage"},
                { "data": "plan.outTime"},
                { "data": "order.advancePayment"},
                { "data": "order.planReturnDate"},
                { "data": "account.name"},
                { "data": "account.phone"}
            ],
            "createdRow": function ( row, data, dataindex ) {
                if(data.order.status==0){
                    $('td', row).eq(1).text("企业租车");
                }
                if(data.order.status==1){
                    $('td', row).eq(1).text("个人租车");
                }
            }
        });
        /*订单数据获取完成*/

        $("#loadorders").on("click","td",function(){
            $("tr.light").removeClass("light");
            $($(this).parent("tr")).addClass("light");
            $("td.oo").removeClass("oo");
            $(this).addClass("oo");
            $(this).siblings().addClass("oo");
            var data = $("#orders").DataTable().row($(this).parents("tr")).data();
            $(":input[name=licensePlate]").val(data.car.licensePlate);
            $(":input[name=orderId]").val(data.order.id);
        /*    $(":input[name=jijiatime]").val(data.order.jijiatime);
            $(":input[name=planReturnDate]").val(data.order.planReturnDate);
            $(":input[name=unitPrice]").val(data.plan.price);
            $(":input[name=unitOutTime]").val(data.plan.outTime);

            $(":input[name=limitMileage]").val(data.order.limitMileage);
            $(":input[name=beforeMileage]").val(data.order.beforeMileage);
            $(":input[name=unitOutMileage]").val(data.plan.outMileage);  */

            $(":input[name=advancePayment]").val(data.order.advancePayment);
            $(":input[name=shouyajin]").val(data.order.shouyajin);

        });
        $( "#datepicker" ).datetimepicker({
            regional:"zh-CN",
            dateFormat:"yy-mm-dd",
            timeFormat: "hh:mm:ss"
        });
        var date = new Date();
        var str = date.getFullYear()+"-"+(date.getMonth()+1)
                +"-"+date.getDate()+" "+date.getHours()
                +":"+date.getMinutes()+":"+date.getSeconds();
        $("#datepicker").val(str);
    });
    function returnCar(){
        var orderId = $(":input[name=orderId]").val();
        var huancheDate = $("#datepicker").val();
        var afterMileage = $(":input[name=afterMileage]").val();
        $.ajax({
            url:"/bmpw/zc/order/returnCarUpdateOrder",
            dataType:"json",
            type:"post",
            data:{"id":orderId,"huancheDate":huancheDate,"afterMileage":afterMileage},
            success:function(data){
                if(data==null){
                    alert("返回空对象！");
                }
                $(":input[name=timePrice]").val(data.timePrice);
                $(":input[name=outMileagePrice]").val(data.outMileagePrice);
                $(":input[name=outTimePrice]").val(data.outTimePrice);
            },
            error:function(){
                alert("还车失败");
            }
        });
    }
    function returnAndBilling(){
/*
       var huancheDate = new Date(("2016-03-05 10:15:00").replace(/-/g,"/") );
        var planReturnDate = new Date(("2016-03-04 10:15:00").replace(/-/g,"/"));
        var cha = huancheDate.getTime() - planReturnDate.getTime();//时间差的毫秒数
        //计算出相差天数
        var days=Math.floor(cha/(24*3600*1000));
        //计算出小时数
        var leave1=cha % (24*3600*1000);    //计算天数后剩余的毫秒数
        var hours=Math.floor(leave1/(3600*1000));
        //计算相差分钟数
        var leave2=leave1%(3600*1000);        //计算小时数后剩余的毫秒数
        var minutes=Math.floor(leave2/(60*1000));
        //计算相差秒数
        var leave3=leave2%(60*1000);
        //计算分钟数后剩余的毫秒数
        var seconds=Math.round(leave3/1000);
        alert(" 相差 "+days+"天 "+hours+"小时 "+minutes+" 分钟"+seconds+" 秒");
*/
    }
    function billing(){

        //var
    }
    function startCount(){
        alert(new Date(parseInt($(":input[name=planReturnDate]").val())));
        alert($(":input[name=jijiatime]").val());
        alert($(":input[name=unitPrice]").val());
        /*计算正常约定的租金（时间没有用完概不退钱）*/
        $(":input[name=timePrice]").val(($(":input[name=jijiatime]").val())*($(":input[name=unitPrice]").val()))


    }
</script>
</body>
</html>