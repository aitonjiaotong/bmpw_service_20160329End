<!DOCTYPE html>
<html style="height: 100%">
<head>
    <meta charset="UTF-8" />
    <title>八闽票务后台管理</title>
    <!-- Mobile Metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <!-- Import google fonts -->
    <!--<link href="http://fonts.useso.com/css?family=Open+Sans:300,400,600,700,800|Shadows+Into+Light" rel="stylesheet" type="text/css" />-->

    <!-- Favicon and touch icons -->
    <link rel="shortcut icon" href="assets/ico/favicon.png" type="image/x-icon" />
    <link rel="apple-touch-icon" href="assets/ico/apple-touch-icon.png" />
    <link rel="apple-touch-icon" sizes="57x57" href="assets/ico/apple-touch-icon-57x57.png" />
    <link rel="apple-touch-icon" sizes="72x72" href="assets/ico/apple-touch-icon-72x72.png" />
    <link rel="apple-touch-icon" sizes="76x76" href="assets/ico/apple-touch-icon-76x76.png" />
    <link rel="apple-touch-icon" sizes="114x114" href="assets/ico/apple-touch-icon-114x114.png" />
    <link rel="apple-touch-icon" sizes="120x120" href="assets/ico/apple-touch-icon-120x120.png" />
    <link rel="apple-touch-icon" sizes="144x144" href="assets/ico/apple-touch-icon-144x144.png" />
    <link rel="apple-touch-icon" sizes="152x152" href="assets/ico/apple-touch-icon-152x152.png" />

    <!-- start: CSS file-->

    <!-- Vendor CSS-->
    <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="assets/vendor/skycons/css/skycons.css" rel="stylesheet" />
    <link href="assets/vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" />

    <!-- Plugins CSS-->
    <link href="assets/plugins/bootkit/css/bootkit.css" rel="stylesheet" />
    <link href="assets/plugins/scrollbar/css/mCustomScrollbar.css" rel="stylesheet" />
    <link href="assets/plugins/jquery-ui/css/jquery-ui-1.10.4.min.css" rel="stylesheet" />

    <!-- Theme CSS -->
    <link href="assets/css/jquery.mmenu.css" rel="stylesheet" />

    <!-- Page CSS -->
    <link href="assets/css/style.css" rel="stylesheet" />
    <link href="assets/css/add-ons.min.css" rel="stylesheet" />
    <link href="JS/jquery.dataTables.css" rel="stylesheet"/>
    <!-- end: CSS file-->


    <!-- Head Libs -->
    <script src="assets/plugins/modernizr/js/modernizr.js"></script>

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <style type="text/css">
        #users{
            color: #000000;
        }

        .edit,.del{
            margin:2px;
        }
        #userbox{
            float: right;
            margin-top: 10px;
            margin-right: 5%;
        }
        #users{
            width: 90%;
            text-align: center;
        }
    </style>
</head>
<body style="height: 100%;">
   <div style="background-color: black;height: 10%;padding-top: 10px;" >
       <img src="assets/img/logo.png" style="height: 80%;">
       <div id="userbox">
       <div class="userbox">
           <a href="#" class="dropdown-toggle" data-toggle="dropdown">
               <div class="profile-info">
                   <span class="name" id="username"></span>
               </div>
               <i class="fa custom-caret"></i>
           </a>
           <div class="dropdown-menu">
               <ul class="list-unstyled">
                   <li class="dropdown-menu-header bk-bg-white bk-margin-top-15">
                       <div class="progress progress-xs  progress-striped active">
                           <div class="progress-bar progress-bar-primary" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
                               60%
                           </div>
                       </div>
                   </li>
                   <li>
                       <a href="/bmpw/updatepassword"><i class="fa fa-wrench"></i>修改密码</a>
                   </li>
                   <li>
                       <a href="/bmpw/Logout"><i class="fa fa-power-off"></i>登出</a>
                   </li>
               </ul>
           </div>
       </div>
       </div>
       <!-- End Userbox -->
   </div>
   <div style="background-color: #2d3e51;height: 5%;color: #ffffff;padding-top: 0.3%;padding-left: 1%"><p style="font-size: 20px;">用户管理</p></div>
   <div id="loadusers">
       <a href="/bmpw/adduser">增加</a>
       <table id="users">
          <thead>
            <tr>
                <th>用户名</th>
                <th>角色</th>
                <th>操作</th>
            </tr>
          </thead>
       </table>
   </div>
<!-- Vendor JS-->
<script src="assets/vendor/js/jquery.min.js"></script>
<script src="assets/vendor/js/jquery-2.1.1.min.js"></script>
<script src="assets/vendor/js/jquery-migrate-1.2.1.min.js"></script>
<script src="assets/vendor/bootstrap/js/bootstrap.min.js"></script>
<script src="assets/vendor/skycons/js/skycons.js"></script>

<!-- Plugins JS-->
<script src="assets/plugins/jquery-ui/js/jquery-ui-1.10.4.min.js"></script>
<script src="assets/plugins/scrollbar/js/jquery.mCustomScrollbar.concat.min.js"></script>
<script src="assets/plugins/bootkit/js/bootkit.js"></script>


<!-- Theme JS -->
<script src="assets/js/jquery.mmenu.min.js"></script>
<script src="assets/js/core.min.js"></script>

<!-- Pages JS -->
<script src="assets/js/pages/activity.js"></script>
<script src="JS/jquery-1.12.0.js"></script>
<script src="JS/cookie_util.js"></script>
<script src="JS/jquery.dataTables.js"></script>
<script type="text/javascript">
    $(function(){
        var username=getCookie("code");
        $("#username").text("欢迎，"+username);
        $("#users").dataTable({
            "serverSide":true,
            "processing": true,
            "ajax":"/bmpw/users/loadusers",
            "bLengthChange": false,
            "bSort": false,
            "bInfo": false,
            "stateSave":true,
            "oLanguage": {
                "sLengthMenu": "每页显示 _MENU_ 条记录",
                "sZeroRecords": "抱歉， 没有找到",
                "sInfo": "从 _START_ 到 _END_ /共 _TOTAL_ 条数据",
                "sInfoEmpty": "没有数据",
                "sInfoFiltered": "(从 _MAX_ 条数据中检索)",
                "oPaginate": {
                    "sFirst": "首页",
                    "sPrevious": "前一页",
                    "sNext": "后一页",
                    "sLast": "尾页"
                },
                "sZeroRecords": "没有检索到数据",
                "sSearch":"搜索登录名"
            },
            "columns":[
                { "data": "code" },
                { "data": "role" },
                { "data": ""}
            ],
            "columnDefs":[{
                "targets":-1,
                "data":null,
                "sDefaultContent":"<button class='edit'>修改角色</button><button class='del'>删除</button>"
            }]
        });
        $("#loadusers").on("click","button.edit",function(){
            var data = $("#users").DataTable().row($(this).parents("tr")).data();
            //alert("修改"+data.code);
            window.location.href="/bmpw/updateUserRole?code="+data.code;
        });
        $("#loadusers").on("click","button.del",function(){
            var data = $("#users").DataTable().row($(this).parents("tr")).data();
            var flag=confirm("确定删除此项吗？");
            if(flag){
                var code=data.code;
                $.ajax({
                    url:"/bmpw/model/deluser",
                    dataType:"json",
                    type:"post",
                    data:{"code":code},
                    success:function(){
                        location.reload();
                    },
                    error:function(){
                        alert("删除失败");
                    }
                });

            }

        });
    });
    </script>
</body>
</html>